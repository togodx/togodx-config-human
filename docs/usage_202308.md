# TogoDX/Humanの使い方
## 統合データ探索の原理
- DBCLSではこれまでに、様々な生命科学データを統一されたフォーマット（RDF形式）で集約したポータルサイト、[RDF Portal](https://rdfportal.org/)の構築を行ってきました。これを利用することで、これまで個別に公開されていた遺伝子、タンパク質、立体構造、相互作用、化合物、糖鎖、疾患、バリアントを含む8つのカテゴリーに関わる20のデータベースから、64のAttributeを収集しました（2023年7月現在）。
- 収集した各Attributeは遺伝子IDや化合物IDといったそれぞれ個別のデータセットIDで整理されており、これらのデータの統合探索を実現するために、システム内では随時データセット間でID変換を行っています。
- ID変換に用いられるデータセット間のリンクは、生命科学のデータセット間のIDの関係を収録したID変換サービス、[TogoID](https://togoid.dbcls.jp/)のデータに基づいて構築されており、各データセットペアにおいて適切な変換経路を設定しています(図1)。
- ![Figure1](https://raw.githubusercontent.com/togodx/togodx-config-human/develop/docs/img/20230802_fig1.png)
- 図1. TogoDX/Humanに含まれるデータセットおよびAttributeの関係図
  - 大きな丸は対象となるデータセットを表しており、それらの間にID変換のためのリンクが張られている。 四角形はAttributeを示しており、繋がっているデータセットのIDをキーとしている。8種類の色は、データセットもしくはAttributeが属するカテゴリーを表している。 この図は、多様なAttributeがキーとなっているID間のリンクを通じて、統合されていることを示している。
 

## トップページの構成とAttributeの操作
- ![Figure2](https://raw.githubusercontent.com/togodx/togodx-config-human/develop/docs/img/20230802_fig2.png)
  - 図2.　TogoDX/Humanのトップページから俯瞰できる各Attributeの分布や内訳
- Explorer画面(トップページ)では、遺伝子発現パターン、タンパク質の局在などの特徴あるアノテーションを"Attribute"として表現しています(図2)。
- 初期状態ではあらかじめ選択された代表的なAttributeのみが表示されていますが、カテゴリー毎にAttributeを追加したり、Attributeのプリセットを選択することでユーザーに即したAttributeをカスタマイズして表示することが可能になっており、カスタマイズした情報はブラウザに記憶されます(図2A)。
- 各Attributeは、項目の構成（内訳）の100%積み上げグラフで表現されており、ユーザーは全データを俯瞰しながら興味あるAttributeを用いてデータを絞り込んだり、データセット全体のうちアノテーションされていない割合を把握することができます。
  - Attributeは展開表示することが可能となっており、階層分類の場合はカラムブラウザが表示され、下位階層での分布を確認することができ(図2B)、連続値分布の場合はヒストグラム表示による直感的な分布の確認が可能です(図2C)。

## 絞り込みによるデータ探索とその結果の取得
- 対象とするデータセットを **"Select target dataset"** から選択します(図2D)。
   - 選択したデータセットを軸としたIDリンクを用いて、データ探索が行われます。
- **"Filtering"** では、各Attributeの分類や値を選択することでデータの絞り込み条件を設定でき、条件を満たすデータセットのIDリストを取得することができます(図2E)。
   - カラムブラウザからは下位階層を絞り込み条件に追加することができます(図2B)。
   - ヒストグラムからは範囲を選択することで、絞り込み条件に追加することができます(図2C)。
 - **"Projection"** では、Filteringで絞り込まれたデータセットIDに対し、興味のあるAttribute階層をマッピングすることで、IDリストにおける分布を調べることができます(図2F)。
    - これによって新たな発見やデータ解釈の可能性を高めることができます。
 - FilteringやProjectionの操作を行うと、画面下方に条件を満たすデータセットIDのプレビューの表が現れ、条件を追加するごとに随時カラムが追加されます。
 - 表上部の矢印アイコン、もしくは"View results"をクリックすることでResults画面に切り替わります(図2G)。
- ![Figure3](https://raw.githubusercontent.com/togodx/togodx-config-human/develop/docs/img/20230802_fig3.png)
  - 図3.　"Filtering"および"Projection"機能を用いた絞り込みによるデータ探索結果の例
- **"Results"** 画面では、絞り込み条件に合致する対象データセットIDの一覧と、Filteringに用いたAttribute情報およびProjectionで指定したAttributeの内訳を表として閲覧できます(図3)。
- 表の上部には、検索結果の内訳のグラフが表示され、視覚的に分布状況を知ることができます(図3A)。
    - 各内訳の総数における絞り込み条件を満たすIDの数、その割合(%)、絞り込み条件を満たすIDの実数に表示を切り替えることで、分布や偏りを評価することができます。
- 各セルに表示されるデータセットIDをクリックすることで、そのIDに関連する詳細なアノテーション情報を確認できます(図3B)。
- 探索結果はTSVファイルとしてダウンロードすることができるので、[JupyterLab](https://jupyterlab.readthedocs.io/)や[Google Colaboratory](https://colab.research.google.com/) などの解析環境を利用し、さらに詳細なデータ解析を行うことができます(図3C)。
- TogoDX/Humanの検索条件はJSON形式ファイルとして入出力可能で、他のユーザーと共有して再現することができます。

### 〈この操作によるデータ探索の例〉
#### 「類似した発現状況を示す遺伝子・タンパク質を標的とする医薬品の開発状況を調べる」
- 複雑な検索条件をひとつのアプリケーションで実現できるのがTogoDX/Humanの特長の一つです。
- この例では、以下の条件を満たすヒトのタンパク質の一覧を取得します。
   - ① 肺または腸で組織特異的に高い遺伝子発現が確認
   - ② タンパク質として細胞膜表面に局在
   - ③ 何らかのタンパク質と化合物の直接の相互作用を検出する方法のデータが存在
   - ④ 「感染」に対する薬効がある化合物に関わる
- ①〜④ の検索条件を各Attributeから探してfiltering条件として追加するだけで、すべての条件を満たす97個のタンパク質のIDリストが得られます(図3)。
- 続いて、Projection機能を使って、絞り込みで得られたタンパク質群が他のAttributeや階層の一部分においてどのような分布を示すかを調べることができます。
- この例では、以下の条件に基づく分類 を行っています。
  - ⑤ [PDB](https://www.wwpdb.org/)におけるタンパク質立体構造データの有無
  - ⑥ [ChEMBL](https://www.ebi.ac.uk/chembl/)におけるすべての適応症における化合物の最高の開発段階（研究段階、第1-3相、上市後）

## IDマッピングによるデータ俯瞰
- ![Figure4](https://raw.githubusercontent.com/togodx/togodx-config-human/develop/docs/img/20230802_fig4.png)
  - 図4.　IDマッピングによるデータ俯瞰の例
- **"Map your IDs"** では、ユーザーの持つIDリストを入力することで各Attributeに対して簡易的なエンリッチメント解析を行うことが可能です。
- IDリストをテキストエリアに入力しSubmitする(図4A)と、各AttributeごとにID変換が行われ、それぞれの内訳に対応するIDの数とp値が計算されます(図4B)。
- 対応するIDを含む内訳にはピンが表示され、また該当するIDが含まれない内訳はグレーアウトされ、分布や偏りを視覚的に確認することができます。また、絞り込みのためのFilterの一つとして利用することも可能である。

### 〈この操作によるデータ探索の例〉
#### COSMICに収載されているがんとの因果関係が示唆されている変異を含む遺伝子の分布や偏りを調べる
- [COSMIC (Catalogue Of Somatic Mutations In Cancer)](https://cancer.sanger.ac.uk/cosmic/) はがんと関連する体細胞変異の情報を集積したデータベースです。
  - このデータベースでは、[Cancer Gene Census（CGC）](https://cancer.sanger.ac.uk/census/)と呼ばれるがんとの因果関係が示唆されている変異を含む遺伝子のカタログを作成しています。
  - そのうち、Tier 2グループはがんにおける役割が強く示唆されているが、利用可能なエビデンスが不足している158の遺伝子が含まれています。
- これらは、TogoDX/Human上における **Ensembl gene ID** のMap your IDsの実行例として **"Try"** ボタンから利用可能です(図4A)。
- 例えば、この158遺伝子がどの組織で特異的に高発現しているかの分類をすぐに確認することができます(図4B)
- また、Gene Ontologyを使って分子機能別に分類することも容易です(図4C)。


---
## 動画マニュアル
- "TogoDX/human を使ってヒトのデータベースを統合的に探索、俯瞰、抽出する", 2021/12/10, TogoTV, [DOI: 10.7875/togotv.2021.079](https://doi.org/10.7875/togotv.2021.079))

[!['TogoDX/human を使ってヒトのデータベースを統合的に探索、俯瞰、抽出する'](https://user-images.githubusercontent.com/2275313/219278446-ef000d1a-892e-4f84-af76-b97e323bb439.png)](https://doi.org/10.7875/togotv.2021.079)

## 画面構成

### Explorer画面

![Explorer](https://raw.githubusercontent.com/togodx/togodx-config-human/develop/docs/img/20211004_togodx_help_attributekeys.png)

Explorer画面(トップページ)では、遺伝子・タンパク質・化合物・疾患など各カテゴリごとに、様々な属性の内訳を俯瞰的に表示したり、絞り込み条件を指定することができます。また、ユーザが持つIDのリストを指定することで、各属性における分布を簡易的なエンリッチメント解析のように表示させることができます。

- `Attribute keys` 各データセットの属性
  - 各属性の`>`ボタンで、詳細データおよび階層分類や連続値分布を、展開したり閉じたりできます。
  - 最上段の`>`ボタンで、全ての属性の詳細を、まとめて展開したり閉じたりできます。
  - 詳細データについては後述の[属性詳細](#属性詳細)を参照。
- `Attribute values` 属性ごとの内訳、階層分類および連続値分布
  - 閉じた状態では、属性ごとに俯瞰的な内訳を表示しています。
  - 展開した状態では、階層分類の場合はカラムブラウザが、連続値分布の場合はヒストグラムが表示されます。
- `Log scale`
  - 各`Attribute values`の内訳を対数表示に切り替え、該当数の少ない内訳を選択しやすくできます。
- `Condition builder` 検索条件の指定
  - `Clear`ボタンを押すと、`Add filters`、`Map attributes`の選択が初期化されます。
- `Select target dataset` データセットの選択
  - 最終的な結果をどのデータセットのIDに対応させて表示するかを指定します。
  - [IDのリンク関係](#idのリンク関係)で示す経路でID変換を行っています。
- `Map your IDs` IDリストのマッピング
  - 利用者の持つIDリストを`Attribute keys`の各属性にマッピングします。
  - データセットを`Select target dataset`で変更すると、入力可能なIDの例がグレーで表示されます。
  - カンマ、スペース、改行区切りのIDリストが入力可能です。
- `Add filters` 絞り込み条件の指定
  - 各属性の`Attribute values`から、内訳や階層分類および連続値の範囲を絞り込み条件として指定します。
    - [Add filtersを用いた探索方法](#add-filtersを用いた探索方法)を参照。
  - 1つの属性内で複数の条件を追加した場合は、いずれかを満たすOR検索となります。
  - 複数の属性から条件を組み合わせて指定した場合、すべてを満たすAND検索となります。
- `Map attributes` 検索結果の各属性における分布
  - `Add filters`で絞り込まれた結果に対し、ここで指定した属性における分布を表示させることができます。
    - [Map attributesを用いた探索方法](#map-attributesを用いた探索方法)を参照。
- `View results` 結果表示
  - `Add filters`で指定した絞り込み条件を満たす[Results画面](#results画面)を表示します。

#### 属性詳細

![Explore](https://raw.githubusercontent.com/togodx/togodx-config-human/develop/docs/img/20211005_togodx_help_attribute.png)

各属性の`>`ボタンで、詳細データを展開表示することができます。

- `Description` 概要説明
  - `Attribute keys`で表示される属性情報の値や分類の内訳に関する説明。
- `API` データ取得方法
  - `Attribute keys`で表示される属性情報を取得するために使用しているAPIのURL。
- `Original data` 元データ
  - `TogoDX/Human`に収載されている属性情報の元データの提供元や出典情報。
- `Version` バージョン
  - `TogoDX/Human`に収載されている属性情報の元データのバージョン情報。
- `Last updated` 更新日
  - `TogoDX/Human`に収載されている属性情報の元データの更新年月日。

階層分類を持つ属性では細分類ごとの内訳が表示されます。

- `Values` 属性の細分類名
- `Total` 属性の総内訳数
- `Mapped` `Map your IDs`で指定したIDの該当数
- `p-value` `Mapped`の該当数と総数を元にしたp値

### Results画面

![result](https://raw.githubusercontent.com/togodx/togodx-config-human/develop/docs/img/20211004_togodx_help_results.png)

絞り込み条件に合致する`Select target dataset`で指定したIDの一覧、または、`Map your IDs`で指定したIDに対応する結果の一覧と、`Add filters`の値および`Map attributes`の内訳が取得できます。画面上部には検索結果の`分布の内訳グラフ`が表示されます。検索結果に含まれる各IDからは、より詳細な情報をポップアップ表示することができます。検索結果は`Saved conditions`からダウンロードすることができます。

- `Saved conditions` 保存された検索条件
  - `Saved Conditions`のプログレスバーでは、データ取得の状況が表示されます。
  - データ取得が全て完了すると`Completed`と表示され、検索条件が`Saved conditions`に保存されます。
  - 検索結果はTSV形式などでダウンロードすることができます。
  - 過去の検索条件をクリックすることで、結果画面を切替えて表示することができます。
  - ブラウザを閉じたり、再読み込みをすると、保存された検索条件はすべて消去されます。
- `分布の内訳グラフ`
  - `Hits/All` デフォルトでは各内訳の総数における、絞り込み条件を満たすIDの数が表示されます。
  - `Hits/All(%)` 上記の割合をパーセント表示します。(`Stretch`)
  - `Hits only` 絞り込み条件を満たすIDの実数だけを表示します。(`Only hit count`)
- `関連情報の表示`
  - 検索結果の表に表示されている各種IDをクリックすると、IDに紐づく関連情報が表示されます。
  - 関連情報の中にリンクがある場合は、外部のデータベースと紐づいており、更に詳細な情報を参照できます。
- `Return`
  - クリックすることで[Explorer画面](#explorer画面)に戻ることができます。
  - ブラウザの戻るボタンでは[Explorer画面](#explorer画面)に戻れないので注意が必要です。
  - [Explorer画面](#explorer画面)からは`Saved conditions`を選択することで[Results画面](#results画面)に戻ってくることができます。

![result_stanza](https://raw.githubusercontent.com/togodx/togodx-config-human/develop/docs/img/20211004_togodx_help_resultsstanza.png)

## 操作方法

### Add filtersを用いた探索方法

`Add filters`では、様々な属性における絞り込み条件を満たすIDセットを取得します。

- `Select target dataset`から検索結果の集計に用いるIDのデータセットを選択します。
- `Condition builder`の`Add filters`をクリックして有効化します（初期状態では選択済みです）。
  - 各属性の`Attribute values`の値をクリックすることで俯瞰的な内訳を条件に追加します。
  - 属性が階層分類を持つ場合は、詳細を展開しチェックボックスをクリックすることで、細分類を条件に追加することができます。
    - カラムブラウザで分類項目の右端に`▶`が表示されている場合は、その項目が子階層を持つことを示します。
  - 属性が連続値分布を持つ場合は、詳細を展開しヒストグラムの範囲を指定することで、選択範囲を条件に追加することができます。
	- 上段のヒストグラムで指定した範囲が下段に拡大表示され、その範囲が`Add filters`に追加されます。
- 絞り込み条件の選択が終わったら、`View results`をクリックします。結果は[Results画面](#results画面)のページで表示されます。

### Map Attributesを用いた探索方法

`Map attributes`では`Add filters`や`Map your IDs`で絞り込まれたIDセットに対し、他の属性での分布を見ることで新たな発見を促します。

- `Select target dataset`から検索結果の集計に用いるIDのデータセットを選択します。
- `Condition builder`の`Map attributes`をクリックして有効化します（初期状態では`Add filters`が選択されているため切替えます）。
  - `Attribute keys`の欄の右端に現れるチェックボックスを選択します。
  - 属性が階層分類を持つ場合は、詳細を展開し`Map following attributes`のチェックボックスを選択することで、細分類における分布表示を指定できます。
- 選択が終わったら、`View results`をクリックします。結果は[Results画面](#results画面)のページで表示されます。

### Map your IDsを用いた探索方法

`Map your IDs`では、手持ちのIDリストに対する各属性での偏りやp値の計算、`Add filters`による絞り込みや、`Map attributes`による他の属性での分布を確認することができます。

- `Select target dataset`で入力するIDに対応するデータセットを選択します。
- `Map your IDs`では、表示されるサンプルIDの表記方法に従ってIDを入力します。
  - 複数のIDは、カンマ、スペース、または改行区切りで入力します。
  - 手持ちのIDが`Select target dataset`に含まれていない場合は、[TogoID](https://togoid.dbcls.jp/)で変換したものを用いることができます。
- `Submit`ボタンを押すと、`In progress`の表記とともに進捗状況を示すバーが表示されます。

![Map your IDs](https://raw.githubusercontent.com/togodx/togodx-config-human/develop/docs/img/20211005_togodx_help_mapyourids_in_progress.png)

- 各属性の内訳ごとに該当するIDの数とp値が計算されます。
  - 各属性で、対応するIDを含む内訳には左肩にピンが表示され、該当するIDがない部分はグレーアウトされます。
  - ピンにマウスオーバーすることで該当数とp値が表示されます。

![Map your IDs](https://raw.githubusercontent.com/togodx/togodx-config-human/develop/docs/img/20211005_togodx_help_mapyourids.png)

## その他

### ページヘッダ

- `About`
  - TogoDX/Humanについての概要へのリンク
- `Help`
  - TogoDX/Humanの用語説明や機能説明へのリンク
- `Example`
  - TogoDX/Humanの具体的な事例解説へのリンク
- `Contact`
  - TogoDX/Humanに関するお問い合わせ

### 初期化

- 起動時あるいは再読み込み時には、画面が全て初期設定に戻ります。
- 上部にある`TogoDX`のロゴをクリックすることでも、初期設定に戻ります。
- `Condition builder`の`Clear`ボタンをクリックすると検索条件が初期化されます。

### IDのリンク関係
![ID relations](https://raw.githubusercontent.com/togodx/togodx-path/main/figures/path-highlight-2022-11.png)

- [TogoDX/Humanで使用されているデータセット間のIDリンク関係の図](https://togodx.github.io/togodx-path/path-highlight-2022-11.html)
- [IDリンク関係の表](https://github.com/togodx/togodx-path/blob/main/tsv/dataset-links-2022-11.tsv)


